# Implementation Plan: Full-Stack Todo Web Application

**Branch**: `001-todo-web-app` | **Date**: 2025-12-26 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-todo-web-app/spec.md`

## Summary

Build a full-stack todo web application that converts the existing console todo app into a multi-user web application. The system uses Better Auth for JWT-based authentication, Neon PostgreSQL for data persistence, and follows RESTful API architecture with strict user-level data isolation.

## Technical Context

**Language/Version**: TypeScript 5.x (Node.js 20+ backend, React 18+ frontend)
**Primary Dependencies**: Express.js (backend), Better Auth (authentication), React (frontend)
**Storage**: Neon PostgreSQL (cloud-hosted PostgreSQL)
**Testing**: Jest (unit/integration), Supertest (API testing)
**Target Platform**: Web browsers (modern Chrome, Firefox, Safari, Edge)
**Project Type**: Web application (backend + frontend)
**Performance Goals**: <2s page load, <500ms API response, 100 concurrent users
**Constraints**: JWT tokens for stateless auth, HTTPS required in production
**Scale/Scope**: 100 concurrent users, responsive design for mobile/desktop

## Constitution Check

*GATE: Must pass before implementation. All items verified.*

- [x] **Principle I (Spec-First)**: spec.md read and understood
- [x] **Principle VI (Backend-First)**: Backend APIs implemented before frontend
- [x] **Principle VII (JWT-Secured)**: All protected endpoints require valid JWT via Better Auth
- [x] **Principle VIII (User Data Isolation)**: All queries filter by authenticated user ID

## Project Structure

### Documentation (this feature)

```text
specs/001-todo-web-app/
├── spec.md              # Feature specification
├── plan.md              # This file
├── tasks.md             # Task list (generated by /sp.tasks)
└── checklists/
    └── requirements.md  # Quality validation
```

### Source Code (repository root)

```text
backend/
├── src/
│   ├── config/
│   │   ├── database.ts      # Neon PostgreSQL connection
│   │   └── auth.ts          # Better Auth configuration
│   ├── models/
│   │   ├── user.ts          # User entity
│   │   └── task.ts          # Task entity
│   ├── middleware/
│   │   ├── auth.ts          # JWT verification middleware
│   │   └── validation.ts    # Input validation middleware
│   ├── routes/
│   │   ├── auth.ts          # Auth routes (register, login, logout, refresh)
│   │   └── tasks.ts         # Task CRUD routes
│   ├── services/
│   │   ├── auth.ts          # Authentication business logic
│   │   └── task.ts          # Task business logic
│   └── index.ts             # Express app entry point
├── tests/
│   ├── integration/
│   │   ├── auth.test.ts     # Auth endpoint tests
│   │   └── tasks.test.ts    # Task endpoint tests
│   └── unit/
│       └── services/        # Service unit tests
├── package.json
└── tsconfig.json

frontend/
├── src/
│   ├── components/
│   │   ├── auth/
│   │   │   ├── LoginForm.tsx
│   │   │   └── RegisterForm.tsx
│   │   ├── tasks/
│   │   │   ├── TaskList.tsx
│   │   │   ├── TaskItem.tsx
│   │   │   ├── TaskForm.tsx
│   │   │   └── TaskFilters.tsx
│   │   └── layout/
│   │       ├── Header.tsx
│   │       └── ProtectedRoute.tsx
│   ├── pages/
│   │   ├── LoginPage.tsx
│   │   ├── RegisterPage.tsx
│   │   └── DashboardPage.tsx
│   ├── services/
│   │   ├── api.ts           # API client with auth headers
│   │   ├── auth.ts          # Auth service (login, register, logout)
│   │   └── tasks.ts         # Task service (CRUD operations)
│   ├── hooks/
│   │   ├── useAuth.ts       # Authentication state hook
│   │   └── useTasks.ts      # Tasks state hook
│   ├── context/
│   │   └── AuthContext.tsx  # Auth context provider
│   ├── App.tsx
│   └── main.tsx
├── package.json
├── tsconfig.json
└── vite.config.ts

# Root configuration
.env.example              # Environment variables template
package.json              # Workspace configuration (if monorepo)
```

**Structure Decision**: Web application structure (Option 2) selected. Backend and frontend are separate projects in the repository root. Backend is implemented first per Constitution Principle VI.

## API Contracts

### Authentication Endpoints (Public)

| Method | Endpoint           | Description          | Request Body                        | Response                |
|--------|-------------------|----------------------|-------------------------------------|-------------------------|
| POST   | /api/auth/register | Register new user    | `{ email, password }`               | `{ user, accessToken }` |
| POST   | /api/auth/login    | Authenticate user    | `{ email, password }`               | `{ user, accessToken }` |
| POST   | /api/auth/logout   | End session          | -                                   | `{ success: true }`     |
| POST   | /api/auth/refresh  | Refresh access token | `{ refreshToken }` or cookie        | `{ accessToken }`       |

### Task Endpoints (Protected - require JWT)

| Method | Endpoint          | Description        | Request Body                                      | Response           |
|--------|------------------|--------------------|---------------------------------------------------|--------------------|
| GET    | /api/tasks       | List user's tasks  | Query: `?status=&priority=&sort=`                 | `{ tasks: [...] }` |
| POST   | /api/tasks       | Create task        | `{ title, description?, dueDate?, priority? }`   | `{ task }`         |
| GET    | /api/tasks/:id   | Get single task    | -                                                 | `{ task }`         |
| PUT    | /api/tasks/:id   | Update task        | `{ title?, description?, completed?, ... }`      | `{ task }`         |
| DELETE | /api/tasks/:id   | Delete task        | -                                                 | `{ success: true }`|

## Data Model

### User
```
- id: UUID (primary key)
- email: string (unique, indexed)
- passwordHash: string
- createdAt: timestamp
- updatedAt: timestamp
```

### Task
```
- id: UUID (primary key)
- userId: UUID (foreign key → User.id, indexed)
- title: string (required, max 255)
- description: text (optional)
- completed: boolean (default: false)
- priority: enum ('low', 'medium', 'high', default: 'medium')
- dueDate: timestamp (optional)
- createdAt: timestamp
- updatedAt: timestamp
```

### Session (managed by Better Auth)
```
- id: UUID
- userId: UUID (foreign key → User.id)
- token: string (hashed)
- expiresAt: timestamp
- createdAt: timestamp
```

## Complexity Tracking

No constitution violations. Standard web application architecture.

---

## Step-by-Step Execution Plan

This numbered plan follows Constitution Principle VI (Backend-First) and references relevant specs.

### Step 1: Project Setup

**Reference**: [plan.md - Project Structure](#project-structure)

1.1. Create monorepo directory structure (`backend/`, `frontend/`)
1.2. Initialize backend Node.js/TypeScript project with Express.js
1.3. Initialize frontend Vite/React/TypeScript project
1.4. Create `.env.example` with required environment variables
1.5. Configure TypeScript for both projects
1.6. Configure ESLint and Prettier for both projects

**Checkpoint**: Empty projects build and run without errors

---

### Step 2: Database Foundation

**Reference**: [data-model.md](./data-model.md), [spec.md - Key Entities](#key-entities)

2.1. Configure Neon PostgreSQL connection (`backend/src/config/database.ts`)
2.2. Create User table migration with indexes
2.3. Create Task table migration with userId foreign key and indexes
2.4. Create Session table migration (for Better Auth)
2.5. Verify migrations run successfully against Neon

**Checkpoint**: Database tables exist with proper relationships

---

### Step 3: Backend Core Infrastructure

**Reference**: [constitution.md - Security Requirements](#security-requirements)

3.1. Create Express app entry point with middleware stack
3.2. Configure CORS for frontend origin
3.3. Create error handling middleware (no sensitive data in errors)
3.4. Create request logging middleware (audit trail)
3.5. Create input validation middleware
3.6. Create User model (`backend/src/models/user.ts`)
3.7. Create Task model (`backend/src/models/task.ts`)
3.8. Create database query helpers (`backend/src/lib/db.ts`)

**Checkpoint**: Express server starts, middleware chain works

---

### Step 4: Authentication Backend (US1)

**Reference**: [spec.md - US1](#user-story-1---user-registration-and-login-priority-p1), [contracts/auth-api.md](./contracts/auth-api.md)

4.1. Configure Better Auth with Neon PostgreSQL adapter
4.2. Create JWT verification middleware (`backend/src/middleware/auth.ts`)
4.3. Implement auth service: register function (FR-001)
4.4. Implement auth service: login function (FR-002)
4.5. Implement auth service: logout function (FR-006)
4.6. Implement auth service: token refresh (FR-005)
4.7. Add password validation (min 8 chars, letter + number) (FR-007)
4.8. Add email validation and duplicate check
4.9. Add authentication event logging (FR-022)
4.10. Create POST `/api/auth/register` route
4.11. Create POST `/api/auth/login` route
4.12. Create POST `/api/auth/logout` route
4.13. Create POST `/api/auth/refresh` route
4.14. Create GET `/api/auth/me` route (session validation)

**Checkpoint**: Auth endpoints work via curl/Postman, tokens issued correctly

---

### Step 5: Task CRUD Backend (US2)

**Reference**: [spec.md - US2](#user-story-2---task-management-crud-priority-p2), [contracts/tasks-api.md](./contracts/tasks-api.md)

5.1. Implement task service: create function (FR-008)
5.2. Implement task service: list tasks (user-scoped) (FR-009)
5.3. Implement task service: get single task (user-scoped)
5.4. Implement task service: update task (user-scoped) (FR-010)
5.5. Implement task service: delete task (user-scoped) (FR-011)
5.6. Add user isolation to ALL queries (WHERE userId = ?) (FR-020)
5.7. Return 404 for tasks belonging to other users (FR-021)
5.8. Add input validation for task title (required, max 255) (FR-023)
5.9. Create GET `/api/tasks` route with filters
5.10. Create POST `/api/tasks` route
5.11. Create GET `/api/tasks/:id` route
5.12. Create PUT `/api/tasks/:id` route
5.13. Create DELETE `/api/tasks/:id` route

**Checkpoint**: Task CRUD works via API, user isolation enforced

---

### Step 6: Task Organization Backend (US3)

**Reference**: [spec.md - US3](#user-story-3---task-organization-priority-p3)

6.1. Add dueDate and priority fields to task creation (FR-015, FR-016)
6.2. Add dueDate and priority fields to task update
6.3. Implement sort parameter (dueDate, priority, createdAt) (FR-017)
6.4. Implement filter parameters (status, priority) (FR-018, FR-019)
6.5. Update GET `/api/tasks` to accept query params

**Checkpoint**: Filtering and sorting work correctly

---

### Step 7: Session Management Backend (US4)

**Reference**: [spec.md - US4](#user-story-4---persistent-session-priority-p4), [research.md - JWT Configuration](#jwt-configuration)

7.1. Configure access token expiry: 15 minutes
7.2. Configure refresh token expiry: 7 days
7.3. Implement refresh token rotation on refresh
7.4. Store refresh tokens in httpOnly cookies

**Checkpoint**: Token refresh works, tokens rotate correctly

---

### Step 8: Frontend Authentication (US1)

**Reference**: [spec.md - US1 Acceptance Scenarios](#user-story-1---user-registration-and-login-priority-p1)

8.1. Create API client with base URL config (`frontend/src/services/api.ts`)
8.2. Create auth service (register, login, logout) (`frontend/src/services/auth.ts`)
8.3. Create AuthContext provider (`frontend/src/context/AuthContext.tsx`)
8.4. Create useAuth hook (`frontend/src/hooks/useAuth.ts`)
8.5. Create LoginForm component with validation
8.6. Create RegisterForm component with validation
8.7. Create LoginPage with redirect logic
8.8. Create RegisterPage with auto-login after registration
8.9. Create ProtectedRoute component for guarded routes
8.10. Configure React Router with auth routes

**Checkpoint**: Users can register, login, logout via UI

---

### Step 9: Frontend Task Management (US2)

**Reference**: [spec.md - US2 Acceptance Scenarios](#user-story-2---task-management-crud-priority-p2)

9.1. Create task service (CRUD operations) (`frontend/src/services/tasks.ts`)
9.2. Create useTasks hook (`frontend/src/hooks/useTasks.ts`)
9.3. Create TaskList component
9.4. Create TaskItem component with completion toggle
9.5. Create TaskForm component (create/edit)
9.6. Create DashboardPage with task list
9.7. Add task delete with confirmation
9.8. Add inline task editing
9.9. Create Header component with logout button
9.10. Add loading states and error handling

**Checkpoint**: Full task CRUD works via UI, only user's tasks visible

---

### Step 10: Frontend Task Organization (US3)

**Reference**: [spec.md - US3 Acceptance Scenarios](#user-story-3---task-organization-priority-p3)

10.1. Add dueDate picker to TaskForm
10.2. Add priority selector to TaskForm
10.3. Create TaskFilters component
10.4. Add sort dropdown (due date, priority, created)
10.5. Add status filter toggle (all/active/completed)
10.6. Add priority filter (all/high/medium/low)
10.7. Display due date with overdue styling in TaskItem
10.8. Display priority indicator in TaskItem
10.9. Integrate TaskFilters into DashboardPage
10.10. Update useTasks hook for filter/sort parameters

**Checkpoint**: Tasks can be organized, sorted, filtered via UI

---

### Step 11: Frontend Session Persistence (US4)

**Reference**: [spec.md - US4 Acceptance Scenarios](#user-story-4---persistent-session-priority-p4)

11.1. Store tokens appropriately (httpOnly cookies for refresh)
11.2. Add auto-refresh logic before token expiry
11.3. Add interceptor for 401 handling (auto-refresh attempt)
11.4. Restore session from storage on app load
11.5. Clear storage on logout

**Checkpoint**: Session persists across browser restarts, auto-refreshes

---

### Step 12: Security Validation

**Reference**: [constitution.md - Principles VII & VIII](#vii-jwt-secured-apis)

12.1. Verify all `/api/tasks/*` routes require valid JWT
12.2. Test user isolation: accessing another user's task returns 404
12.3. Verify password hashing in database (no plaintext)
12.4. Test input sanitization (XSS, SQL injection blocked)
12.5. Verify error messages don't leak sensitive info
12.6. Add rate limiting to auth endpoints
12.7. Configure HTTPS redirect for production

**Checkpoint**: All security requirements from constitution verified

---

### Step 13: Polish and Finalization

**Reference**: [quickstart.md - Validation Scenarios](./quickstart.md)

13.1. Add loading spinners to all async operations
13.2. Add toast notifications for success/error feedback
13.3. Ensure responsive design for mobile
13.4. Finalize `.env.example` with all variables
13.5. Add startup validation for required env vars
13.6. Create README.md with setup instructions
13.7. Manually verify all acceptance scenarios from spec.md

**Checkpoint**: Application production-ready

---

## Execution Summary

| Step | Description | Tasks | Backend | Frontend |
|------|-------------|-------|---------|----------|
| 1 | Project Setup | 6 | Yes | Yes |
| 2 | Database Foundation | 5 | Yes | No |
| 3 | Backend Core | 8 | Yes | No |
| 4 | Auth Backend (US1) | 14 | Yes | No |
| 5 | Task CRUD Backend (US2) | 13 | Yes | No |
| 6 | Task Org Backend (US3) | 5 | Yes | No |
| 7 | Session Backend (US4) | 4 | Yes | No |
| 8 | Auth Frontend (US1) | 10 | No | Yes |
| 9 | Task CRUD Frontend (US2) | 10 | No | Yes |
| 10 | Task Org Frontend (US3) | 10 | No | Yes |
| 11 | Session Frontend (US4) | 5 | No | Yes |
| 12 | Security Validation | 7 | Yes | No |
| 13 | Polish | 7 | Yes | Yes |
| **Total** | | **104** | | |

**MVP Milestone**: Complete Steps 1-5, 8-9 for core auth + task CRUD (66 steps)

---

## Design Artifacts Generated

| Artifact | Path | Description |
|----------|------|-------------|
| Research | [research.md](./research.md) | Technology decisions and rationale |
| Data Model | [data-model.md](./data-model.md) | Entity definitions and migrations |
| Auth API Contract | [contracts/auth-api.md](./contracts/auth-api.md) | Authentication endpoints |
| Tasks API Contract | [contracts/tasks-api.md](./contracts/tasks-api.md) | Task CRUD endpoints |
| Quickstart | [quickstart.md](./quickstart.md) | Setup and validation guide |
